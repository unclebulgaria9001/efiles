<!DOCTYPE html>
<html>
<head>
    <title>Epstein Documents - Network Graph</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background: #1a1a1a;
            color: #fff;
        }
        #graph {
            width: 100%;
            height: 800px;
            border: 1px solid #333;
            background: #0a0a0a;
        }
        .node {
            stroke: #fff;
            stroke-width: 1.5px;
        }
        .link {
            stroke: #999;
            stroke-opacity: 0.6;
        }
        .node-label {
            font-size: 10px;
            fill: #fff;
            pointer-events: none;
        }
        #info {
            margin-top: 20px;
            padding: 15px;
            background: #2a2a2a;
            border-radius: 5px;
        }
        h1 {
            color: #4CAF50;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        .stat-box {
            background: #333;
            padding: 15px;
            border-radius: 5px;
            border-left: 3px solid #4CAF50;
        }
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #4CAF50;
        }
        .stat-label {
            font-size: 12px;
            color: #999;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <h1>Epstein Documents - Interaction Network</h1>
    
    <div class="stats">
        <div class="stat-box">
            <div class="stat-value" id="nodeCount">0</div>
            <div class="stat-label">People Identified</div>
        </div>
        <div class="stat-box">
            <div class="stat-value" id="edgeCount">0</div>
            <div class="stat-label">Connections</div>
        </div>
        <div class="stat-box">
            <div class="stat-value" id="docCount">388</div>
            <div class="stat-label">Documents Analyzed</div>
        </div>
    </div>
    
    <div id="graph"></div>
    
    <div id="info">
        <h3>Instructions</h3>
        <p>â€¢ Hover over nodes to see person names</p>
        <p>â€¢ Node size represents number of mentions</p>
        <p>â€¢ Line thickness represents connection strength</p>
        <p>â€¢ Drag nodes to rearrange the graph</p>
    </div>
    
    <script>
        // Load the graph data
        fetch('interaction_graph.json')
            .then(response => response.json())
            .then(data => {
                document.getElementById('nodeCount').textContent = data.nodes.length;
                document.getElementById('edgeCount').textContent = data.edges.length;
                
                // Filter to top 100 most connected nodes for performance
                const topNodes = data.nodes
                    .sort((a, b) => b.connections - a.connections)
                    .slice(0, 100);
                
                const nodeIds = new Set(topNodes.map(n => n.id));
                const filteredEdges = data.edges.filter(e => 
                    nodeIds.has(e.source) && nodeIds.has(e.target)
                );
                
                createGraph(topNodes, filteredEdges);
            });
        
        function createGraph(nodes, edges) {
            const width = document.getElementById('graph').clientWidth;
            const height = 800;
            
            const svg = d3.select('#graph')
                .append('svg')
                .attr('width', width)
                .attr('height', height);
            
            const simulation = d3.forceSimulation(nodes)
                .force('link', d3.forceLink(edges).id(d => d.id).distance(100))
                .force('charge', d3.forceManyBody().strength(-300))
                .force('center', d3.forceCenter(width / 2, height / 2))
                .force('collision', d3.forceCollide().radius(d => Math.sqrt(d.mentions) * 2 + 5));
            
            const link = svg.append('g')
                .selectAll('line')
                .data(edges)
                .enter().append('line')
                .attr('class', 'link')
                .attr('stroke-width', d => Math.sqrt(d.weight));
            
            const node = svg.append('g')
                .selectAll('circle')
                .data(nodes)
                .enter().append('circle')
                .attr('class', 'node')
                .attr('r', d => Math.sqrt(d.mentions) * 2 + 3)
                .attr('fill', d => {
                    const vips = ['epstein', 'maxwell', 'giuffre', 'virginia giuffre', 'ghislaine maxwell'];
                    return vips.includes(d.id.toLowerCase()) ? '#ff4444' : '#4CAF50';
                })
                .call(d3.drag()
                    .on('start', dragstarted)
                    .on('drag', dragged)
                    .on('end', dragended));
            
            node.append('title')
                .text(d => \\nMentions: \\nConnections: \);
            
            simulation.on('tick', () => {
                link
                    .attr('x1', d => d.source.x)
                    .attr('y1', d => d.source.y)
                    .attr('x2', d => d.target.x)
                    .attr('y2', d => d.target.y);
                
                node
                    .attr('cx', d => d.x)
                    .attr('cy', d => d.y);
            });
            
            function dragstarted(event, d) {
                if (!event.active) simulation.alphaTarget(0.3).restart();
                d.fx = d.x;
                d.fy = d.y;
            }
            
            function dragged(event, d) {
                d.fx = event.x;
                d.fy = event.y;
            }
            
            function dragended(event, d) {
                if (!event.active) simulation.alphaTarget(0);
                d.fx = null;
                d.fy = null;
            }
        }
    </script>
</body>
</html>
